<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Biomedizin- und Gesundheitstechnik</title>
    <style>
      body { margin: 20px; font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; background: #f4f6f8; color: #111; }
      h1 { margin-bottom: 8px; font-size: 18px; }
      #container { display: flex; flex-direction: column; gap: 18px; align-items: flex-start; }
      #ui { width: 300px; }
      .controls { display: flex; gap: 8px; margin-top: 6px; flex-wrap: wrap; }
      button { padding: 8px 10px; border-radius: 8px; border: 1px solid #bbb; background: #fff; cursor: pointer; }
      .small { margin-top: 8px; font-size: 13px; color: #444; }
      #status { margin-top: 12px; font-weight: 700; }
      canvas { image-rendering: auto; border-radius: 3px; box-shadow: 0 8px 28px rgba(0, 0, 0, 0.12); }
      .legend { margin-top: 12px; font-size: 13px; }
      .pad { display: inline-block; padding: 6px 8px; border-radius: 6px; background: #fff; border: 1px solid #ddd; margin-right: 6px; }
      .info-block { text-align: center; margin-top: 1px; }
      .arrow { display: block; margin: 0 auto 1px auto; width: 60px; pointer-events: none; }
      #speechBubble { position: absolute; top: 180px; left: 330px; background: #ffffff; border: 2px solid #333; border-radius: 24px; 
        padding: 14px 24px; font-size: 20px; font-weight: 600;  color: #111;
        box-shadow: 2px 4px 12px rgba(0,0,0,0.18);
        opacity: 0;
        pointer-events: none;
        z-index: 10;
        animation: fadeInOut 5s ease-in-out forwards;
      }

/* kleiner Pfeil (zeigt Richtung Mund) */
#speechBubble::after {
  content: "";
  position: absolute;
  bottom: 14px;                  /* leicht seitlich unten ansetzen */
  left: -18px;                   /* Zipfel auf der linken Seite */
  border-width: 10px 18px 10px 0;
  border-style: solid;
  border-color: transparent #ffffff transparent transparent;
}

/* Ein-/Ausblend-Animation bleibt gleich */
@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-10px); }
  10%, 80% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-10px); }
}


    </style>
  </head>

  <body>
    <h1>Biomedizin- und Gesundheitstechnik</h1>
    <div id="container">
      <div id="ui">
        <div class="controls">
          <button id="resetBtn">Reset Zuordnungen</button>
          <button id="autoBtn">Automatisch Zuordnen</button>
        </div>
        <div class="small">
          Klicke zuerst ein Organ (links) und dann die passende
          Stelle im K√∂rper an. Wenn alles richtig zugeordnet ist, lacht die
          Figur!
        </div>
        <div id="status">Leg Los!</div>
      </div>

      <div id="canvasWrap" style="position: relative;">
        <canvas id="canvas" width="512" height="768"></canvas>
        <img id="smoke" src="img/rain.gif"
          style="position:absolute;top:0;left:0;width:512px;height:768px;display:none;pointer-events:none;">
        <div id="speechBubble">Hallo!</div>
      </div>

      <div class="info-block">
        <img src="img/arrow.gif" alt="Pfeil nach unten" class="arrow">
        <p>Hier lernst du so tolle Sachen:<br>
          <a
            href="https://www.htl-salzburg.at/biomedizin-gesundheitstechnik.html">
            HTBLuVA-Salzburg Biomedizin & Gesundheitstechnik
          </a>
        </p>
      </div>
    </div>

    <script>
/* === Name & animierte Begr√º√üung === */
const userName = "Lisa"; // <-- Hier kannst du den Namen √§ndern
const speechBubble = document.getElementById("speechBubble");

window.addEventListener("load", () => {
  speechBubble.textContent = `Hallo ${userName}!`;
  speechBubble.style.opacity = "1";       // Startanimation
  speechBubble.style.display = "block";
  // Nach 5s komplett ausblenden (nach Ende der Animation)
  setTimeout(() => { speechBubble.style.display = "none"; }, 5000);
});

// === Setup Canvas ===
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d", { alpha: true });
const statusEl = document.getElementById("status");
const resetBtn = document.getElementById("resetBtn");
const autoBtn = document.getElementById("autoBtn");
const smokeImg = document.getElementById("smoke");

// === Images ===
const imgBase = new Image();
const imgHappy = new Image();
const imgDmg = new Image();
imgBase.src = "img/body_female.png";
imgHappy.src = "img/body_happy_female.png";
imgDmg.src = "img/body_sad_female.png";

// === Pads ===
const PAD_R = 6;
const pads = [
  { id: 0, x: 50, y: 50, label: "Herz", type: "organ" },
  { id: 1, x: 50, y: 100, label: "Lunge", type: "organ" },
  { id: 2, x: 50, y: 150, label: "Leber", type: "organ" },
  { id: 3, x: 50, y: 200, label: "Magen", type: "organ" },
  { id: 4, x: 50, y: 250, label: "Darm", type: "organ" },
  { id: 5, x: 270, y: 400, label: "Herz", type: "spot" },
  { id: 6, x: 220, y: 370, label: "Lunge", type: "spot" },
  { id: 7, x: 210, y: 480, label: "Leber", type: "spot" },
  { id: 8, x: 320, y: 500, label: "Magen", type: "spot" },
  { id: 9, x: 270, y: 565, label: "Darm", type: "spot" }
];

const edges = new Set();
let selectedPad = null;
let currentBg = imgBase;

// === Hilfsfunktionen ===
function edgeKey(a,b){ if(a>b)[a,b]=[b,a]; return `${a}-${b}`; }
function parseEdge(e){ const [a,b]=e.split("-").map(Number); return {a,b}; }
function toggleEdge(a,b){ const k=edgeKey(a,b); edges.has(k)?edges.delete(k):edges.add(k); }

function padUnder(x,y){ return pads.find(p=>Math.hypot(p.x-x,p.y-y)<=PAD_R+8)||null; }

function isConnected(a,b){
  const n=pads.length;
  const adj=Array.from({length:n},()=>[]);
  for(const e of edges){ const {a:aa,b:bb}=parseEdge(e); adj[aa].push(bb); adj[bb].push(aa); }
  const q=[a]; const seen=new Set([a]);
  while(q.length){ const u=q.shift(); if(u===b)return true;
    for(const v of adj[u]) if(!seen.has(v)){ seen.add(v); q.push(v); } }
  return false;
}

// === Evaluierung ===
function evaluateState(){
  const pairs=[[0,5],[1,6],[2,7],[3,8],[4,9]];
  let correct=0, wrong=false;
  for(const [o,s] of pairs) if(isConnected(o,s)) correct++;
  for(const e of edges){
    const {a,b}=parseEdge(e); const pa=pads[a], pb=pads[b];
    if(pa.type===pb.type) wrong=true;
    if(pa.type==="organ"&&pb.type==="spot"&&!pairs.some(p=>p[0]===pa.id&&p[1]===pb.id)) wrong=true;
    if(pb.type==="organ"&&pa.type==="spot"&&!pairs.some(p=>p[0]===pb.id&&p[1]===pa.id)) wrong=true;
  }
  if(wrong){ currentBg=imgDmg; smokeImg.style.display="block"; statusEl.textContent="Oh nein! Da stimmt etwas nicht..."; }
  else if(correct===5){ currentBg=imgHappy; smokeImg.style.display="none"; statusEl.textContent="Super! Alles richtig zugeordnet üòÑ"; }
  else { currentBg=imgBase; smokeImg.style.display="none"; statusEl.textContent=`Offen: ${edges.size} Verbindung(en).`; }
  draw();
}

// === Zeichnen ===
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(currentBg.complete) ctx.drawImage(currentBg,0,0,canvas.width,canvas.height);
  for(const e of edges){
    const {a,b}=parseEdge(e), pa=pads[a], pb=pads[b];
    ctx.beginPath(); ctx.moveTo(pa.x,pa.y); ctx.lineTo(pb.x,pb.y);
    ctx.lineWidth=4; ctx.strokeStyle="#ff4d4d"; ctx.lineCap="round"; ctx.stroke();
  }
  for(const p of pads){
    ctx.beginPath();
    ctx.fillStyle=(p.type==="organ")?"#fff":"#d9b34b";
    ctx.arc(p.x,p.y,PAD_R,0,Math.PI*2);
    ctx.fill(); ctx.strokeStyle="#888"; ctx.stroke();
    if(p.type==="organ"){ ctx.font="13px sans-serif"; ctx.fillStyle="#333"; ctx.textAlign="left"; ctx.textBaseline="middle"; ctx.fillText(p.label,p.x+16,p.y); }
  }
  if(selectedPad){
    ctx.beginPath(); ctx.lineWidth=2; ctx.strokeStyle="#E8524B";
    ctx.arc(selectedPad.x,selectedPad.y,PAD_R+6,0,Math.PI*2); ctx.stroke();
  }
}

// === Klicklogik ===
canvas.addEventListener("click",ev=>{
  const rect=canvas.getBoundingClientRect();
  const x=ev.clientX-rect.left, y=ev.clientY-rect.top;
  const pad=padUnder(x,y);
  if(!pad){ selectedPad=null; draw(); return; }
  if(!selectedPad){ selectedPad=pad; draw(); return; }
  if(selectedPad.id===pad.id){ selectedPad=null; draw(); return; }
  toggleEdge(selectedPad.id,pad.id);
  selectedPad=null;
  evaluateState();
});

// === Buttons ===
resetBtn.onclick=()=>{ edges.clear(); selectedPad=null; currentBg=imgBase; smokeImg.style.display="none"; statusEl.textContent="Zuordnungen entfernt. Leg Los!"; draw(); };
autoBtn.onclick=()=>{ edges.clear(); [[0,5],[1,6],[2,7],[3,8],[4,9]].forEach(([a,b])=>edges.add(edgeKey(a,b))); evaluateState(); };

// === Start ===
imgBase.onload=draw;
    </script>
  </body>
</html>
